{
  "$schema": "https://json.schemastore.org/branch-protection",
  "description": "Branch protection rules for The Nash Group repositories",
  "patterns": {
    "main": {
      "protection": {
        "required_status_checks": {
          "strict": true,
          "contexts": [
            "CI Enforcer - The Gatekeeper / Quick Validation",
            "CI Enforcer - The Gatekeeper / Code Quality Checks (lint)",
            "CI Enforcer - The Gatekeeper / Code Quality Checks (format)",
            "CI Enforcer - The Gatekeeper / Security Scanning",
            "CI Enforcer - The Gatekeeper / Test Suite (unit)",
            "CI Enforcer - The Gatekeeper / Test Suite (integration)",
            "CI Enforcer - The Gatekeeper / Build Verification (production)",
            "CI Enforcer - The Gatekeeper / Final Validation"
          ]
        },
        "enforce_admins": false,
        "required_pull_request_reviews": {
          "required_approving_review_count": 2,
          "dismiss_stale_reviews": true,
          "require_code_owner_reviews": true,
          "dismissal_restrictions": {
            "teams": ["the-nash-group/watchers"]
          },
          "require_last_push_approval": true
        },
        "restrictions": {
          "users": [],
          "teams": ["the-nash-group/watchers", "the-nash-group/mentors"],
          "apps": []
        },
        "allow_force_pushes": false,
        "allow_deletions": false,
        "block_creations": false,
        "required_conversation_resolution": true,
        "lock_branch": false,
        "allow_fork_syncing": false,
        "required_linear_history": false
      }
    },
    "develop": {
      "protection": {
        "required_status_checks": {
          "strict": false,
          "contexts": [
            "CI Enforcer - The Gatekeeper / Quick Validation",
            "CI Enforcer - The Gatekeeper / Code Quality Checks (lint)",
            "CI Enforcer - The Gatekeeper / Test Suite (unit)"
          ]
        },
        "enforce_admins": false,
        "required_pull_request_reviews": {
          "required_approving_review_count": 1,
          "dismiss_stale_reviews": true,
          "require_code_owner_reviews": false,
          "require_last_push_approval": false
        },
        "restrictions": null,
        "allow_force_pushes": false,
        "allow_deletions": false,
        "required_conversation_resolution": false
      }
    },
    "release/*": {
      "protection": {
        "required_status_checks": {
          "strict": true,
          "contexts": [
            "CI Enforcer - The Gatekeeper / Final Validation"
          ]
        },
        "enforce_admins": true,
        "required_pull_request_reviews": {
          "required_approving_review_count": 2,
          "dismiss_stale_reviews": true,
          "require_code_owner_reviews": true,
          "dismissal_restrictions": {
            "teams": ["the-nash-group/watchers"]
          }
        },
        "restrictions": {
          "teams": ["the-nash-group/watchers"]
        },
        "allow_force_pushes": false,
        "allow_deletions": false,
        "required_conversation_resolution": true
      }
    },
    "hotfix/*": {
      "protection": {
        "required_status_checks": {
          "strict": false,
          "contexts": [
            "CI Enforcer - The Gatekeeper / Security Scanning",
            "CI Enforcer - The Gatekeeper / Test Suite (unit)"
          ]
        },
        "enforce_admins": false,
        "required_pull_request_reviews": {
          "required_approving_review_count": 1,
          "dismiss_stale_reviews": false,
          "require_code_owner_reviews": true
        },
        "restrictions": {
          "teams": ["the-nash-group/watchers", "the-nash-group/mentors"]
        },
        "allow_force_pushes": false,
        "allow_deletions": false
      }
    }
  },
  "rules": [
    {
      "name": "Protect main branch",
      "target": "main",
      "enforcement": "active",
      "conditions": {
        "ref_name": {
          "exclude": [],
          "include": ["refs/heads/main"]
        }
      },
      "rules": [
        {
          "type": "pull_request",
          "parameters": {
            "required_approving_review_count": 2,
            "dismiss_stale_reviews_on_push": true,
            "require_code_owner_review": true,
            "require_last_push_approval": true,
            "required_review_thread_resolution": true
          }
        },
        {
          "type": "required_status_checks",
          "parameters": {
            "strict_required_status_checks_policy": true,
            "required_status_checks": [
              "ci-enforcer",
              "security-scan",
              "test-suite"
            ]
          }
        },
        {
          "type": "non_fast_forward",
          "parameters": {}
        },
        {
          "type": "commit_message_pattern",
          "parameters": {
            "name": "Conventional Commits",
            "pattern": "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\\(.+\\))?: .+",
            "operator": "matches"
          }
        }
      ]
    },
    {
      "name": "Protect release branches",
      "target": "release/*",
      "enforcement": "active",
      "conditions": {
        "ref_name": {
          "exclude": [],
          "include": ["refs/heads/release/*"]
        }
      },
      "rules": [
        {
          "type": "pull_request",
          "parameters": {
            "required_approving_review_count": 2,
            "dismiss_stale_reviews_on_push": true,
            "require_code_owner_review": true
          }
        },
        {
          "type": "required_deployments",
          "parameters": {
            "required_deployment_environments": ["staging"]
          }
        }
      ]
    }
  ]
}